{% extends 'layout.html' %}

{% block body %}
<div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">Create your account</h2>
    <p class="mt-2 text-center text-sm text-gray-600">
      Or
      <a href="{{ url_for('auth.login') }}" class="font-medium text-indigo-600 hover:text-indigo-500">sign in to your account</a>
    </p>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <form id="signupForm" action="{{ url_for('auth.signup') }}" method="post" class="space-y-6">
        <!-- Step Progress -->
        <div class="mb-8">
          <div class="flex justify-between items-center">
            <div class="w-full flex items-center">
              <div class="relative w-full">
                <div class="h-1 bg-gray-200 rounded-full">
                  <div id="progressBar" class="h-1 bg-indigo-600 rounded-full transition-all duration-300" style="width: 33%"></div>
                </div>
                <div class="flex justify-between items-center mt-2">
                  <div class="step-indicator active" data-step="1">
                    <span class="w-8 h-8 flex items-center justify-center rounded-full bg-indigo-600 text-white text-sm">1</span>
                    <span class="text-xs mt-1 text-gray-500">Account</span>
                  </div>
                  <div class="step-indicator" data-step="2">
                    <span class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600 text-sm">2</span>
                    <span class="text-xs mt-1 text-gray-500">Role</span>
                  </div>
                  <div class="step-indicator" data-step="3">
                    <span class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600 text-sm">3</span>
                    <span class="text-xs mt-1 text-gray-500">Details</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 1: Account Information -->
        <div id="step1" class="step-content">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Email address</label>
            <div class="mt-1">
              <input id="email" name="email" type="email" autocomplete="email" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>

          <div>
            <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
            <div class="mt-1">
              <input id="username" name="username" type="text" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
            <div class="mt-1">
              <input id="password" name="password" type="password" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>

          <div>
            <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirm Password</label>
            <div class="mt-1">
              <input id="confirm_password" name="confirm_password" type="password" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>
        </div>

        <!-- Step 2: Role Selection -->
        <div id="step2" class="step-content hidden">
          <div class="space-y-4">
            <div class="relative">
              <label class="block p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500">
                <input type="radio" name="role" value="customer" class="hidden" required>
                <div class="flex items-center justify-between">
                  <div>
                    <span class="text-lg font-medium text-gray-900">I want to hire</span>
                    <p class="text-sm text-gray-500">Post projects and hire talented freelancers</p>
                  </div>
                  <svg class="role-check h-5 w-5 text-indigo-600 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                </div>
              </label>
            </div>

            <div class="relative">
              <label class="block p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500">
                <input type="radio" name="role" value="seller" class="hidden" required>
                <div class="flex items-center justify-between">
                  <div>
                    <span class="text-lg font-medium text-gray-900">I want to work</span>
                    <p class="text-sm text-gray-500">Find projects and offer your services</p>
                  </div>
                  <svg class="role-check h-5 w-5 text-indigo-600 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Step 3: Additional Details -->
        <div id="step3" class="step-content hidden">
          <div>
            <label for="firstname" class="block text-sm font-medium text-gray-700">First name</label>
            <div class="mt-1">
              <input id="firstname" name="firstname" type="text" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>

          <div>
            <label for="lastname" class="block text-sm font-medium text-gray-700">Last name</label>
            <div class="mt-1">
              <input id="lastname" name="lastname" type="text" required
                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
          </div>

          <!-- Freelancer-specific fields -->
          <div id="freelancer-fields" class="hidden">
            <div>
              <label for="skills" class="block text-sm font-medium text-gray-700">Skills (comma-separated)</label>
              <div class="mt-1">
                <input id="skills" name="skills" type="text" placeholder="e.g., Python, JavaScript, Web Design"
                  class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
              </div>
            </div>

            <div>
              <label for="hourly_rate" class="block text-sm font-medium text-gray-700">Hourly Rate (KES)</label>
              <div class="mt-1">
                <input id="hourly_rate" name="hourly_rate" type="number" min="0"
                  class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
              </div>
            </div>

            <div>
              <label for="bio" class="block text-sm font-medium text-gray-700">Bio</label>
              <div class="mt-1">
                <textarea id="bio" name="bio" rows="3"
                  class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="flex justify-between">
          <button type="button" id="prevBtn" class="hidden inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Previous
          </button>
          <button type="button" id="nextBtn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Next
          </button>
          <button type="submit" id="submitBtn" class="hidden inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Create Account
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
let currentStep = 1;
const totalSteps = 3;

function updateProgressBar() {
  const progress = (currentStep / totalSteps) * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
  
  // Update step indicators
  document.querySelectorAll('.step-indicator').forEach((step, index) => {
    const stepNum = index + 1;
    const circle = step.querySelector('span:first-child');
    if (stepNum <= currentStep) {
      circle.classList.remove('bg-gray-200', 'text-gray-600');
      circle.classList.add('bg-indigo-600', 'text-white');
    } else {
      circle.classList.remove('bg-indigo-600', 'text-white');
      circle.classList.add('bg-gray-200', 'text-gray-600');
    }
  });
}

function showStep(step) {
  document.querySelectorAll('.step-content').forEach(content => {
    content.classList.add('hidden');
  });
  document.getElementById(`step${step}`).classList.remove('hidden');
  
  // Update buttons
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  
  prevBtn.classList.toggle('hidden', step === 1);
  nextBtn.classList.toggle('hidden', step === totalSteps);
  submitBtn.classList.toggle('hidden', step !== totalSteps);
  
  updateProgressBar();
}

function validateStep(step) {
  const currentStepEl = document.getElementById(`step${step}`);
  const requiredFields = currentStepEl.querySelectorAll('[required]');
  let isValid = true;

  requiredFields.forEach(field => {
    if (!field.value) {
      isValid = false;
      field.classList.add('border-red-500');
    } else {
      field.classList.remove('border-red-500');
    }
  });

  if (step === 1) {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    if (password !== confirmPassword) {
      isValid = false;
      document.getElementById('confirm_password').classList.add('border-red-500');
      alert('Passwords do not match');
    }
  }

  return isValid;
}

document.getElementById('nextBtn').addEventListener('click', () => {
  if (validateStep(currentStep)) {
    currentStep++;
    showStep(currentStep);
  }
});

document.getElementById('prevBtn').addEventListener('click', () => {
  currentStep--;
  showStep(currentStep);
});

// Handle role selection
document.querySelectorAll('input[name="role"]').forEach(radio => {
  radio.addEventListener('change', (e) => {
    document.querySelectorAll('.role-check').forEach(check => check.classList.add('hidden'));
    const selectedLabel = e.target.closest('label');
    selectedLabel.querySelector('.role-check').classList.remove('hidden');
    
    // Show/hide freelancer fields in step 3
    const freelancerFields = document.getElementById('freelancer-fields');
    if (e.target.value === 'seller') {
      freelancerFields.classList.remove('hidden');
      freelancerFields.querySelectorAll('input, textarea').forEach(field => field.required = true);
    } else {
      freelancerFields.classList.add('hidden');
      freelancerFields.querySelectorAll('input, textarea').forEach(field => field.required = false);
    }
  });
});

// Initialize
showStep(1);
</script>
{% endblock %}